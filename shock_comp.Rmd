---
title: "Shock comparison"
author: "Juho Koistinen"
date: "2022-09-28"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
liblist <- c("readr", "tidyverse", "lubridate", "fbi", "readxl", "vars", "svars", "svarmawhf", "lemon") 
void <- lapply(liblist, library, character.only = TRUE)

rotmat <- function(x, n){
  
  rot_ix <- combn(n,2)
  final_mat <- diag(n)
  
  for(jj in 1:ncol(rot_ix)){
    rot_mat <- matrix(c(cos(x[jj]), -sin(x[jj]), sin(x[jj]), cos(x[jj])), 2, 2)
    temp_mat <- diag(n)
    temp_mat[rot_ix[,jj], rot_ix[,jj]] <- rot_mat
    final_mat <- final_mat %*% temp_mat
  }
  
  final_mat
}

ff <- function(x, zero_ix, input_mat){
  
  row_ix <- if(is.null(dim(zero_ix))) zero_ix[1] else zero_ix[,1]
  col_ix <- if(is.null(dim(zero_ix))) zero_ix[2] else zero_ix[,2]
  sum(sqrt(diag(input_mat[row_ix,] %*% rotmat(x, ncol(input_mat))[, col_ix])^2))
}

get_irf <- function(datamat, n_lags, id.type = c("chol", "n_gaus"), n_ahead, zero_rest = NULL){
  
  nobs <- dim(datamat)[1]
  n_var <- dim(datamat)[2]
  var_out <- vars::VAR(datamat, p = n_lags, type = "both")
  if(id.type=="chol"){
    bmat <- var_out %>% residuals %>% var %>% chol %>% t
  } else if(id.type=="n_gaus"){
    bmat <- svars::id.ngml(var_out)$B
    if(!is.null(zero_rest)){
      incr <- 0
      conv_crit <- 1
      while(conv_crit>sqrt(.Machine$double.eps)){
        grid <- 0.01*pi*incr + sqrt(.Machine$double.eps)
        opt_out <- optim(par = rep(0, choose(n_var, 2)),
                         fn = ff,
                         method = "L-BFGS-B",
                         zero_ix = zero_rest,
                         input_mat = bmat,
                         lower = -rep(grid, choose(n_var, 2)), 
                         upper = rep(grid, choose(n_var, 2)))
        conv_crit <- opt_out$value
        incr <- incr+1
      }
      bmat <- bmat%*%rotmat(opt_out$par, n_var)
    }
  } else{
    stop("Specify identification scheme correctly")
  }
  irf_out <- var_out %>% irf(boot=FALSE, n.ahead = n_ahead, ortho = FALSE) %>% .$irf %>%
    reduce(cbind) %>% t %>% c %>% array(dim=c(n_var, n_var, n_ahead+1))
  list_out <- list(irf = unclass(pseries(irf_out, n_ahead)%r%bmat), bmat = bmat)
  if(!is.null(zero_rest)){
    list_out$rotmat <- rotmat(opt_out$par, n_var)
    list_out$incr <- incr
  }
  return(list_out)
}
```

# Introduction and preliminaries

This document summarizes the results from different VAR specifications, which use different monetary policy shock measures to uncover the dynamic effects of monetary policy.

The benchmark VAR consists of four widely used monetary policy variables:
$$
z_t = (100\cdot\log IP_t, 100\cdot\log CPI_t,EBP_t, FFR_t)'.
$$
The underlying assumption is that the policy equation is given as
$$
FFR_t = f(\Omega_t)+\varepsilon_t^{mp},
$$
where the deviation from the policy rate can be divided into a true surprise and anticipated component, known by public $q$ months ahead

$$
\varepsilon_t^{mp} = \varepsilon_t^{mps} + \varepsilon_{t-q}^{news}.
$$

To identify both components of the error to $FFR_t$, the baseline VAR is augmented with a monetary policy residual, $MPR_t\approx\varepsilon_t^{mps}+\varepsilon_{t-q}^{news}$, which reveals the monetary news/forward guidance component:
$$
y_t = (z_t', MPR_t)'.
$$

```{r load econ vars, include=FALSE}
bs_data <- read_excel(path = "./local_data/FOMC_Bauer_Swanson.xlsx", 
                      sheet = "Monthly SVAR Data") %>% 
  rename(date = ...1, GS2 = `2y Treas`) %>% 
  mutate(date = ymd(str_remove(date, " UTC")),
         LIP = 100*log(IP),
         LCPI = 100*log(CPI))
  
ramey_rep <- read_excel(path = "./local_data/Monetarydat_ramey.xlsx", 
                        sheet = "Monthly") %>% 
  mutate(DATES = substr(DATES, 1, 4) %>% 
           paste0(c(rep("0", 9), rep("", 3)), 1:12, "01") %>% ymd(),
         LIP = 100*LIP,
         LCPI = 100*LCPI) %>% 
  rename(date = DATES)

fred_md <- fredmd("http://files.stlouisfed.org/files/htdocs/fred-md/monthly/current.csv",
                  transform = FALSE,
                  date_start = ymd(19730101)) %>%
  as_tibble() %>% 
  mutate(LIP = 100*log(INDPRO),
         LCPI = 100*log(CPIAUCSL),
         DLCPI = c(rep(NaN, 12), diff(LCPI, 12)))
ebp <- read_csv("https://www.federalreserve.gov/econres/notes/feds-notes/ebp_csv.csv")
fred_md$EBP <- ebp$ebp[1:nrow(fred_md)]
```

```{r plot, echo=FALSE}
fred_md %>%
  dplyr::select(date, LIP, LCPI, FEDFUNDS, EBP) %>% 
  filter(date>=ymd(19821001), date<ymd(20090101)) %>%
  mutate_at(vars(starts_with("L")), ~residuals(lm(.~1+I(1:n())))) %>% 
  pivot_longer(-date, names_to = "Variable", values_to = "Value") %>% 
  ggplot(aes(date, Value, color = Variable)) + 
  geom_line() + 
  facet_grid(factor(Variable, levels = c("LIP", "LCPI", "FEDFUNDS", "EBP")) ~ ., scales = "free_y") + 
  scale_x_date(date_labels = "%b %Y",date_breaks = "1 year", expand = c(10^-2,1) ) + 
  theme(legend.position = "none", 
      axis.text.x = element_text(angle = 90),
      axis.title.x = element_blank(),
      axis.title.y = element_blank()) +
    ggtitle("Raw Data")
```

# Identification

We entertain two identification schemes:

1. Internal instrument/recursive, where $MPS_t$ is ordered first and the model is identified recursively. This gives results consistent with the external instrument/Proxy-SVAR approach. Only the conventional MP shock is identified and this is primarily used for comparison to the results using identification by non-Gaussianity.

2. Identification by non-Gaussianity. The aim is to identify structural shocks both to $FFR_t$ and $MPS_t$, where the former is the conventional and the latter is an anticipated monetary news shock. The identification is achieved by assuming shock non-Gaussianity combined with the short-run restriction that the news shock does not have contemporaneous effect on $MPS_t$.

# Results: Baseline VAR

```{r basis VAR, include=FALSE}
n_ahead <- 48
svar_data <- fred_md %>%
  dplyr::select(date, LIP, LCPI, EBP, FEDFUNDS) %>% 
  filter(date>=ymd(19821001), date<ymd(20080101)) %>%
  mutate_if(is.numeric, ~. - mean(.)) %>% 
  mutate_at(vars(starts_with("L")), ~residuals(lm(. ~ I(1:n())))) %>%
  dplyr::select(-date)
```


```{r basis VARb, echo=FALSE}
irf_bl <- get_irf(datamat = svar_data, n_lags = 12, id.type = "n_gaus", n_ahead = n_ahead)

tibble(irf = c(irf_bl$irf[,4,]), 
       months=rep(0:n_ahead, each=4), 
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS")) %>% 
         rep(n_ahead + 1)) %>% 
  mutate(irf = irf/irf[4]*0.25) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ ., scales = "free_y") + 
  scale_x_continuous(breaks = seq(0, n_ahead, by = 6)[-1], expand = c(0,0)) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_rect(fill="azure"),
        axis.line = element_line(colour = "black")) +
    ggtitle("Baseline VAR", subtitle = "responses to 25bp MP shock")
```

# Romer and Romer (2004)
The Romer and Romer (2004) shock is expected to be short-lived and not to contain a forward guidance component, which would show up in the delayed response of FFR.

```{r rr04, include=FALSE}
rr04 <- read_excel(path = "./local_data/shock_list.xlsx",
                   sheet = "RR04") %>% 
  mutate(date = substr(date, 1, 4) %>% 
           paste0(c(rep("0", 9), rep("", 3)), 1:12, "01") %>% ymd) %>% 
  filter(date>=ymd(19821001), date<ymd(20080101))

ds <- svar_data %>% filter(seq(ymd(19821001), ymd(20071201), by="month") %in% rr04$date)
ds$mpr <- rr04$resid_full
irf1 <- get_irf(datamat = ds, n_lags = 12, id.type = "n_gaus", n_ahead = 48, zero_rest = c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```

```{r rr04b, echo=FALSE}
tibble(irf = pseries(irf1$irf, n_ahead) %>% unclass %>% .[,c(5,4),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Romer and Romer shocks",
          subtitle = "responses to 25bp shocks")
```

# Gertler and Karadi (2015)
```{r gk15, include=FALSE}
gk15 <- read_excel(path = "./local_data/shock_list.xlsx",
                   sheet = "GK15") %>% 
  mutate(date = paste0(year, ifelse(month<10, "0",""), month, "01") %>% ymd) %>% 
  filter(date>=ymd(19821001), date<ymd(20090101))

ds <- svar_data %>% filter(seq(ymd(19821001), ymd(20081201), by="month") %in% gk15$date)
ds$mpr <- gk15$mp1_tc*100
irf1 <- get_irf(datamat = ds, n_lags = 12, id.type = "n_gaus", n_ahead = 48, zero_rest = c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```


```{r gk15b, echo=FALSE}
tibble(irf = irf1$irf %>% .[,c(4,5),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Gertler and Karadi shocks (1)",
          subtitle = "responses to 25bp shocks")
```

```{r gk15bb, include=FALSE}
ds <- svar_data %>% filter(seq(ymd(19821001), ymd(20081201), by="month") %in% gk15$date[is.finite(gk15$ff4_tc)])
ds$mpr <- gk15$ff4_tc[is.finite(gk15$ff4_tc)]*100
irf1 <- get_irf(datamat = ds, n_lags = 12, id.type = "n_gaus", n_ahead = 48, zero_rest = c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```


```{r gk15bbb, echo=FALSE}
tibble(irf = pseries(irf1$irf, n_ahead) %>% unclass %>% .[,c(4,5),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Gertler and Karadi shocks (2)",
          subtitle = "responses to 25bp shocks")

```

# Miranda-Agrippino and Ricco (2021)

```{r mar21, include=FALSE}
mar21 <- read_excel(path = "./local_data/shock_list.xlsx",
                   sheet = "MAR21") %>% 
  mutate(date = paste0(time, "01") %>% ymd) %>% 
  filter(date>=ymd(19821001), date<ymd(20090101))

ds <- svar_data %>% filter(seq(ymd(19821001), ymd(20081201), by="month") %in% mar21$date)
ds$mpr <- mar21$MM_IV1*100
irf1 <- get_irf(datamat = ds, n_lags = 12, id.type = "n_gaus", n_ahead = 48, zero_rest = c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```


```{r mar21b, echo=FALSE}
tibble(irf = pseries(irf1$irf, n_ahead) %>% unclass %>% .[,c(4,5),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Miranda-Agrippino and Ricco shocks (1)",
          subtitle = "responses to 25bp shocks")
```

```{r mar21bb, include=FALSE}
ds$mpr <- mar21$MM_IV5*100
irf1 <- get_irf(datamat = ds, n_lags = 12, id.type = "n_gaus", n_ahead = 48, zero_rest = c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```


```{r mar21bbb, echo=FALSE}
tibble(irf = irf1$irf %>% unclass %>% .[,c(4,5),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Miranda-Agrippino and Ricco shocks (2)",
          subtitle = "responses to 25bp shocks")
```

# Jarocinski (2022)

```{r jaro22, include=FALSE}
jaro21 <- read_csv("https://marekjarocinski.github.io/files/U1bp.csv")
jaro21 <- jaro21 %>% 
  mutate(month = sapply(month, function(x) paste0(if(nchar(x)<2) "0", x)),
         date = ym(paste0(year, month))) %>% 
  group_by(date) %>% 
  summarise_at(vars(starts_with("u")), mean)
jaro_final <- tibble(date = seq(jaro21$date[1], jaro21$date[nrow(jaro21)], by ="month"),
                  u1 = 0, u2 = 0, u3 = 0, u4 = 0)
jaro_final[jaro_final$date %in% jaro21$date, ] <- jaro21

ds <- svar_data %>% filter(seq(ymd(19821001), ymd(20081201), by="month") %in% jaro_final$date)

ds$mpr <- jaro_final %>% filter(date>=ymd(19821001), date<ymd(20090101)) %>%  dplyr::select(u1)
irf1 <- get_irf(ds, 12, id.type = "n_gaus", 48, zero_rest = c(5,5))
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/irf1$irf[4,4,1]*0.25
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/max(irf1$irf[4,5,])*0.25
```


```{r jaro22b, echo=FALSE}
tibble(irf = irf1$irf %>% unclass %>% .[,c(5,4),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Miranda-Agrippino and Ricco shocks (2)",
          subtitle = "responses to 25bp shocks")

```

# Aruoba and Drechsel (2022)

```{r ad22, include=FALSE}
AD22 <- read_excel(path = "./local_data/shock_list.xlsx",
                   sheet = "AD22") %>% 
  mutate(date = ymd(str_remove(date, " UTC"))) %>% 
  filter(date>=ymd(19821001), date<ymd(20090101))

ds <- svar_data %>% filter(seq(ymd(19821001), ymd(20081201), by="month") %in% AD22$date)
ds$mpr <- AD22$Shock
irf1 <- get_irf(datamat = ds, n_lags = 12, n_ahead = 48, id.type = "n_gaus",zero_rest = c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```


```{r ad22b, echo=FALSE}
tibble(irf = pseries(irf1$irf, n_ahead) %>% unclass %>% .[,c(4,5),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Aruoba and Drechsel shocks",
          subtitle = "responses to 25bp shocks")
```

# Bauer and Swanson (2022)

```{r bs22, include=FALSE}
BS22 <- read_excel(path = "./local_data/shock_list.xlsx",
                   sheet = "BS22") %>% 
  mutate(date = ymd(str_remove(date, " UTC"))) %>% 
  filter(date>=ymd(19821001), date<ymd(20090101))

ds <- svar_data %>% filter(seq(ymd(19821001), ymd(20081201), by="month") %in% BS22$date)
ds$mpr <- BS22$MPS_ORTH
irf1 <- get_irf(datamat = ds, n_lags = 12, n_ahead = 48, id.type = "n_gaus", c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```


```{r bs22b, echo=FALSE}
tibble(irf = pseries(irf1$irf, n_ahead) %>% unclass %>% .[,c(4,5),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Bauer and Swanson shocks (1)",
          subtitle = "responses to 25bp shocks")


```

```{r include=FALSE}
ds$mpr <- BS22$MPS
irf1 <- get_irf(datamat = ds, n_lags = 12, n_ahead = 48, id.type = "n_gaus", c(5,4))
irf1$irf[,5,] <- irf1$irf[,5,,drop=FALSE]/irf1$irf[4,5,1]*0.25
irf1$irf[,4,] <- irf1$irf[,4,,drop=FALSE]/max(irf1$irf[4,4,])*0.25
```


```{r echo=FALSE}
tibble(irf = pseries(irf1$irf, n_ahead) %>% unclass %>% .[,c(4,5),] %>% c,
       variable = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR") %>% 
         factor(levels = c("log IP", "log CPI", "EBP", "FEDFUNDS", "MPR")) %>% 
         rep((n_ahead+1)*2),
       shock = c("news", "surprise") %>% 
         factor(levels=c("news", "surprise")) %>% 
         rep(each=5) %>% 
         rep(n_ahead+1),
       months = rep(0:n_ahead, each = 10)) %>% 
  ggplot(aes(x=months, y = irf)) +
  geom_line() +
  geom_hline(yintercept = 0, size = 0.15) +
  facet_grid(variable ~ shock, scales = "free_y") +
  facet_rep_grid(variable ~ shock, scales = "free_y", repeat.tick.labels = 'left') +
  scale_x_continuous(breaks = seq(12, n_ahead, by = 12), expand = c(0,0)) +
  scale_y_continuous(n.breaks = 5) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 0),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.spacing = unit(.5, "lines"),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        axis.line = element_line(colour = "black")) +
  ggtitle("VAR w/ Bauer and Swanson shocks (2)",
          subtitle = "responses to 25bp shocks")
```

